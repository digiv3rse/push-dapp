import{ea as ne,eb as ie,bi as v,b1 as e,b2 as l,ec as D,dV as U,dT as te,bY as b,aY as A,a_ as C,bp as m,b$ as Z,dw as B,cC as G,aZ as H,b0 as j,cI as re,cJ as J,ed as le,bq as oe,dY as ce,dZ as de,cG as he,ee as ue,__tla as ge}from"./index-BpAO4u4p.js";import{u as W,__tla as xe}from"./useMutation-DWVhHn6u.js";import{S as pe,__tla as me}from"./Stepper-D5lyrt9v.js";import{g as fe,__tla as ye}from"./Common.utils-DEtEa-aL.js";import{c as be,a as Q,u as Ce,F as je,b as we,__tla as Ie}from"./index.esm-B30qjss3.js";import{i as _e,__tla as ve}from"./ValidationHelper-C6ZkUeku.js";import{C as Se,__tla as ke}from"./ContentLayout-0T4g_DQT.js";let X,De=Promise.all([(()=>{try{return ge}catch{}})(),(()=>{try{return xe}catch{}})(),(()=>{try{return me}catch{}})(),(()=>{try{return ye}catch{}})(),(()=>{try{return Ie}catch{}})(),(()=>{try{return ve}catch{}})(),(()=>{try{return ke}catch{}})()]).then(async()=>{let T,E,P,N,K,M,F,S,R,V,w,$,q,z,Y;T=a=>a,E=a=>a,P=({userPushSDKInstance:a,alias:s})=>a.channel.alias.initiate(s).then(T),N=({userPushSDKInstance:a,channelAddress:s})=>a.channel.alias.verify(s).then(E),K=()=>W({mutationKey:[ne],mutationFn:P}),M=()=>W({mutationKey:[ie],mutationFn:N}),F=[{label:"New Address",value:"newaddress"},{label:"Change Network",value:"changenetwork"},{label:"Verify Alias Chain",value:"verifyalias"}],S=v.allowedNetworks.filter(a=>a!=v.coreContractChain),R=be().shape({alias:Q().required("Address is required").test("is-valid-address","Invalid wallet address",_e),chainId:Q().required("ChainId is required")}),V=({children:a,onSubmit:s})=>{const t=Ce({initialValues:{alias:"",chainId:S[0].toString()},validationSchema:R,onSubmit:s});return e.jsx(je,{value:t,children:a})},w=()=>{const a=we();if(!a)throw new Error("useChainAliasFormikContext must be used within a FormikChainAliasProvider");return a},$=({isLoading:a,channelDetails:s})=>{const t=fe(S),{values:d,handleSubmit:h,handleChange:u,errors:n,touched:i}=w(),g=s==null?void 0:s.aliases.find(o=>o.alias_blockchain_id===d.chainId),x=()=>!(!g&&d.alias);return e.jsxs(l,{width:"100%",display:"flex",flexDirection:"column",gap:"spacing-lg",children:[g&&e.jsx(D,{variant:"error",heading:"Channel already exists on this chain. Select a different chain to proceed.",showIcon:!0}),e.jsx("form",{onSubmit:h,children:e.jsxs(l,{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",gap:"spacing-xl",children:[e.jsxs(l,{display:"flex",flexDirection:{ml:"column",dp:"row"},gap:"spacing-xs",alignItems:"flex-start",width:"100%",children:[e.jsx(U,{label:"Your Address on New Chain",description:"Make sure you own this alias as verification will take place.",value:d.alias,onChange:u("alias"),error:(i==null?void 0:i.alias)&&!!(n!=null&&n.alias),errorMessage:i!=null&&i.alias?n==null?void 0:n.alias:""}),e.jsx(l,{display:"flex",alignSelf:"center",width:{dp:"auto",ml:"100%"},margin:"spacing-xxxs spacing-none spacing-none spacing-none",children:e.jsx(te,{options:t,value:d.chainId,onSelect:u("chainId"),error:(i==null?void 0:i.chainId)&&!!(n!=null&&n.chainId),errorMessage:i!=null&&i.chainId?n.chainId:""})})]}),e.jsx(b,{disabled:x(),variant:"primary",loading:a,children:a?"Adding new chain":"Add"})]})})]})},q=({handleNextStep:a})=>{const{switchChain:s,chainId:t}=A(),{values:d}=w(),h=parseInt(d.chainId);return C.useEffect(()=>{t===h&&a("verifyalias")},[t]),e.jsxs(l,{display:"flex",flexDirection:"column",gap:"spacing-xl",alignItems:"center",children:[e.jsx(m,{variant:"bs-semibold",color:"text-primary",children:"Switch to the desired chain in your wallet to add it to your channel."}),e.jsx(b,{onClick:()=>s(h),children:"Change Network"})]})},z=({alaisDetails:a})=>{const{userPushSDKInstance:s}=Z(r=>r.user),{account:t,chainId:d}=A(),{mutate:h,isPending:u}=M(),{values:n}=w(),i=parseInt(n.chainId),{data:g}=B((a==null?void 0:a.channel)||""),x=n.alias,o=G(),f=H(),p=g==null?void 0:g.aliases.find(r=>r.alias_blockchain_id===n.chainId&&r.is_alias_verified),I=p?"Channel already exists on this chain.":t!==x?"Incorrect address. Connect using the correct address to proceed.":"",y=()=>!(!p&&d===i&&t===x),_=()=>{h({userPushSDKInstance:s,channelAddress:(a==null?void 0:a.channel)??""},{onSuccess:()=>{o.showMessageToast({toastTitle:"Success",toastMessage:"Verification Successful",toastType:"SUCCESS",getToastIcon:r=>e.jsx(re,{size:r,color:"green"})}),f(`${j.ChannelDashboard}/${t}}`)},onError:r=>{r&&o.showMessageToast({toastTitle:"Error",toastMessage:r.message,toastType:"ERROR",getToastIcon:k=>e.jsx(J,{size:k,color:"red"})})}})};return e.jsxs(l,{display:"flex",flexDirection:"column",gap:"spacing-xl",width:"100%",alignItems:"center",children:[I&&e.jsx(l,{width:"100%",children:e.jsx(D,{variant:"error",heading:I,showIcon:!0,onAction:p?()=>f(`${j.ChannelDashboard}/${t}}`):void 0,actionText:p?"Back to Home":void 0})}),e.jsxs(l,{display:"flex",flexDirection:"column",gap:"spacing-sm",children:[e.jsxs(m,{variant:"bs-semibold",textAlign:"center",color:"text-primary",children:["You\u2019re almost there!",e.jsx("br",{})," Verify the address on the new chain to send notifications."]}),e.jsx(U,{disabled:!0,value:x})]}),e.jsx(b,{disabled:y(),onClick:_,loading:u,children:u?"Verifying":"Verify New Address"})]})},Y=()=>{const[a,s]=C.useState("newaddress"),[t,d]=C.useState(["newaddress"]),[h,u]=C.useState(!0),n=G(),{mutate:i,isPending:g,isError:x}=K(),{userPushSDKInstance:o}=Z(c=>c.user),{account:f,chainId:p,switchChain:I}=A(),{data:y}=B(f),{data:_}=le({alias:f,aliasChain:ue[p]}),r=H();C.useEffect(()=>{u(o&&(o==null?void 0:o.readmode()))},[o]);const k=(c,ae)=>{i({userPushSDKInstance:o,alias:he(c,parseInt(ae))},{onSuccess:()=>{L("changenetwork")},onError:O=>{O&&n.showMessageToast({toastTitle:"Error",toastMessage:O.message,toastType:"ERROR",getToastIcon:se=>e.jsx(J,{size:se,color:"red"})})}})},L=c=>{d([...new Set([...t,c])]),s(c)},ee=()=>{r(y?`${j.ChannelDashboard}/${f}}`:j.WelcomeDashboard),u(!1)};return e.jsx(V,{onSubmit:c=>k(c.alias,c.chainId),children:e.jsxs(l,{display:"flex",flexDirection:"column",alignItems:"center",margin:{ml:"spacing-lg spacing-md",dp:"spacing-lg spacing-none spacing-none spacing-none"},padding:{dp:"spacing-lg",ml:"spacing-sm"},gap:"spacing-lg",borderRadius:"radius-lg",backgroundColor:"surface-primary",children:[e.jsxs(l,{display:"flex",flexDirection:"column",alignItems:"center",gap:"spacing-xxxs",children:[e.jsx(m,{color:"text-primary",variant:"h3-semibold",display:{ml:"none",dp:"block"},children:"Add New Chain to Channel"}),e.jsx(m,{color:"text-primary",variant:"h4-semibold",display:{ml:"block",dp:"none"},children:"Add New Chain to Channel"}),e.jsx(m,{color:"text-tertiary",variant:"bs-regular",display:{ml:"none",dp:"block"},children:"Add an alias chain to your channel to enable notifications to that chain."}),e.jsx(m,{display:{ml:"block",dp:"none"},color:"text-tertiary",variant:"bes-regular",children:"Add an alias chain to your channel to enable notifications to that chain."})]}),p!==v.coreContractChain&&t.length===1?e.jsxs(e.Fragment,{children:[e.jsx(l,{display:"flex",padding:"spacing-md",flexDirection:"column",gap:"spacing-sm",alignSelf:"stretch",alignItems:"flex-start",borderRadius:"radius-sm",backgroundColor:"surface-secondary",children:e.jsx(m,{textAlign:"center",color:"text-brand-medium",variant:"h5-semibold",children:"Please change your network to Ethereum to proceed."})}),e.jsx(b,{onClick:()=>I(v.coreContractChain),children:"Change Network"})]}):y||_?e.jsxs(e.Fragment,{children:[e.jsx(pe,{steps:F,completedSteps:t,setActiveStepKey:c=>s(c)}),a==="newaddress"&&e.jsx($,{isLoading:g&&!x,channelDetails:y}),a==="changenetwork"&&e.jsx(q,{handleNextStep:L}),a==="verifyalias"&&e.jsx(z,{alaisDetails:_}),h&&e.jsx(l,{display:"flex",justifyContent:"center",width:"-webkit-fill-available",alignItems:"center",css:oe`
                  z-index: 99999;
                `,children:e.jsx(ce,{type:de.MODAL,showConnectModal:!0,onClose:ee})})]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{variant:"error",showIcon:!0,heading:"User does not have a channel on Push. Create a channel to proceed."}),e.jsx(b,{onClick:()=>r(j.CreateChannel),children:"Create Channel"})]})]})})},X=()=>e.jsx(Se,{children:e.jsx(Y,{})})});export{De as __tla,X as default};

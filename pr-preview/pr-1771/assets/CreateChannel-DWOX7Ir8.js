import{b2 as e,bp as de,bk as ee,bl as P,bm as ne,e0 as he,b3 as i,dQ as ae,dR as pe,bW as k,bq as u,cm as ge,co as ue,e1 as xe,aZ as T,bj as te,b0 as f,e2 as me,br as fe,bn as ye,bo as Ce,a_ as je,e3 as be,e4 as we,e5 as Se,b1 as ve,e6 as ke,__tla as De}from"./index-CtiFW6pI.js";import{E as _e,__tla as Ne}from"./ErrorFilled-tGalmvoL.js";import{S as Re,__tla as Ie}from"./Stepper-CEoc64dM.js";import{S as Ee,I as Le,a as Pe,u as Te,__tla as Ue}from"./ImportPushTokenMessage-nNA1azgp.js";import{u as Fe,__tla as Ae}from"./useMutation-KwCfOGCM.js";import{c as Be,a as U,u as qe,F as Ke,b as Me,__tla as Oe}from"./index.esm-CuA03WYm.js";import{g as F,a as re,U as Ge}from"./Common.form-LPxQflxb.js";import{g as Ve,__tla as He}from"./PushTokenContractHelper-DFsFh8LL.js";let se,We=Promise.all([(()=>{try{return De}catch{}})(),(()=>{try{return Ne}catch{}})(),(()=>{try{return Ie}catch{}})(),(()=>{try{return Ue}catch{}})(),(()=>{try{return Ae}catch{}})(),(()=>{try{return Oe}catch{}})(),(()=>{try{return He}catch{}})()]).then(async()=>{let A,B,q,K,M,D,O,_,G,S,I,V,H,W,z,J,Y,E;A=n=>{const{svgProps:c,...s}=n;return e.jsx(de,{componentName:"CloudUpload",icon:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"inherit",height:"inherit",viewBox:"0 0 53 52",fill:"none",...c,children:[e.jsx("path",{d:"M16.1888 26.3978L26.7966 15.7901L37.4043 26.3978",stroke:"#C4CBD5","stroke-width":"2.5","stroke-linecap":"round","stroke-linejoin":"round"}),e.jsx("path",{d:"M27.0618 50.0001V16.8509",stroke:"#C4CBD5","stroke-width":"2.5","stroke-linecap":"round","stroke-linejoin":"round"}),e.jsx("path",{d:"M21.4927 35.4144H11.1502C8.05625 35.0608 1.86841 32.4972 1.86841 25.0718C1.86841 17.6464 8.05625 14.9061 11.1502 14.4641C11.769 10.3094 15.6585 2 26.2662 2C39.2607 2 41.0286 10.8398 41.9126 16.0553C45.0065 15.9669 51.4596 19.2906 51.4596 26.9282C51.2828 29.7569 49.6032 35.4144 44.2993 35.4144C38.9955 35.4144 34.1336 35.4144 32.3656 35.4144",stroke:"#C4CBD5","stroke-width":"2.5","stroke-linecap":"round","stroke-linejoin":"round"})]}),...s})},B=async n=>{const{channelType:c,identityBytes:s,fees:d,signer:p}=n;return(await new ee(P.epnscore,ne.epnscore,p).createChannelWithPUSH(c,s,d,0,{gasLimit:6e5})).wait()},q=()=>Fe({mutationKey:[he],mutationFn:B}),K=Be().shape({channelName:U().required(F("Channel Name")).max(32,re(32)),channelDesc:U().required(F("Channel Description")).max(250,re(250)),channelURL:U().required(F("Channel URL")).test("url","Please enter a valid channel url",n=>Ge.test(n))}),M=({children:n,onSubmit:c})=>{const s=qe({initialValues:{channelName:"",channelDesc:"",channelURL:"",image:null},validationSchema:K,onSubmit:c});return e.jsx(Ke,{value:s,children:n})},D=()=>{const n=Me();if(!n)throw new Error("useChainAliasFormikContext must be used within a FormikChainAliasProvider");return n},O=({handleNextStep:n,setActiveStepKey:c})=>{const{values:s,touched:d,setFieldTouched:p,setFieldValue:o,errors:a,validateForm:C,setTouched:j}=D(),g=()=>{C().then(t=>{j({channelName:!0,channelDesc:!0,channelURL:!0}),Object.keys(t).length===0&&(n("uploadLogo"),c("uploadLogo"))})};return e.jsx(i,{display:"flex",flexDirection:"column",alignSelf:"stretch",children:e.jsxs(i,{display:"flex",flexDirection:"column",gap:"spacing-xl",alignSelf:"stretch",children:[e.jsxs(i,{display:"flex",flexDirection:"column",gap:"spacing-sm",alignSelf:"stretch",children:[e.jsx(ae,{required:!0,label:"Channel Name",value:s.channelName,onChange:t=>{const r=t.target.value;p("channelName",!0),o("channelName",r)},totalCount:32,error:d.channelName&&!!(a!=null&&a.channelName),errorMessage:d.channelName?a==null?void 0:a.channelName:""}),e.jsx(pe,{required:!0,label:"Channel Description",placeholder:"Get notified about ...",description:"Enter a Brief description of the notifications the user will receive",value:s.channelDesc,onChange:t=>{const r=t.target.value;p("channelDesc",!0),o("channelDesc",r)},totalCount:250,error:d.channelDesc&&!!(a!=null&&a.channelDesc),errorMessage:d.channelURL?a==null?void 0:a.channelDesc:""}),e.jsx(ae,{required:!0,label:"Channel Website URL",value:s.channelURL,onChange:t=>{const r=t.target.value;p("channelURL",!0),o("channelURL",r)},error:d.channelURL&&!!(a!=null&&a.channelURL),errorMessage:d.channelURL?a==null?void 0:a.channelURL:""})]}),e.jsx(i,{display:"flex",justifyContent:"center",children:e.jsx(k,{onClick:g,children:"Next"})})]})})},_=50,G=[{label:"Channel Info",value:"channelInfo"},{label:"Upload Logo",value:"uploadLogo"},{label:"Stake Fees",value:"stakeFees"}],S={progress:null,progressInfo:"",processingInfo:""},I={txErrorStatus:0,txError:""},V=()=>e.jsxs(i,{display:"flex",flexDirection:"column",alignItems:"center",alignSelf:"stretch",children:[e.jsx(u,{variant:"h3-semibold",color:"text-primary",display:{ml:"none",dp:"block"},children:"Create Your Channel"}),e.jsx(u,{variant:"bs-regular",color:"text-tertiary",display:{ml:"none",dp:"block"},children:"Creating your own notification channel to manage, send and notify users."}),e.jsx(u,{variant:"h4-semibold",color:"text-primary",display:{ml:"block",dp:"none"},children:"Create Your Channel"}),e.jsx(u,{variant:"bes-regular",color:"text-tertiary",display:{ml:"block",dp:"none"},textAlign:"center",children:"Creating your own notification channel to manage, send and notify users."})]}),H=({progressState:n})=>e.jsxs(i,{display:"flex",flexDirection:"column",alignSelf:"stretch",gap:"spacing-xl",alignItems:"center",children:[e.jsx(i,{padding:"spacing-md",backgroundColor:"surface-secondary",borderRadius:"radius-sm",width:"-webkit-fill-available",children:e.jsx(u,{textAlign:"center",variant:"h5-semibold",color:"text-brand-medium",children:n.progressInfo})}),e.jsx(i,{width:"400px",children:e.jsx(ge,{percent:n.progress,color:"#D548EC",backgroundColor:"#F3AEFF",height:"4px"})}),e.jsxs(i,{display:"flex",flexDirection:"row",alignItems:"center",gap:"spacing-xxxs",children:[e.jsx(ue,{type:xe.PROCESSING,size:16,color:"#D548EC"}),e.jsx(u,{variant:"bs-semibold",color:"text-secondary",children:n.processingInfo})]})]}),W=()=>{const{switchChain:n}=T();return e.jsxs(e.Fragment,{children:[e.jsx(i,{display:"flex",flexDirection:"column",padding:"spacing-md",backgroundColor:"surface-secondary",borderRadius:"radius-sm",width:"-webkit-fill-available",children:e.jsx(u,{textAlign:"center",variant:"h5-semibold",color:"text-brand-medium",children:"Please select Ethereum Sepolia Network in your Wallet to create a channel."})}),e.jsx(i,{display:"flex",justifyContent:"center",children:e.jsx(k,{onClick:()=>n(te.coreContractChain),children:"Change Network"})})]})},z=({handleNextStep:n})=>{const{provider:c,account:s}=T(),[d,p]=f.useState(0),[o,a]=f.useState(!1),C=async()=>{a(!0);const r=await Ve({address:s,provider:c});a(!1),p(r)};f.useEffect(()=>{!s||!c||C()},[d,s]);const{handleSubmit:j,validateForm:g}=D(),t=()=>{g().then(r=>{(r.channelName||r.channelDesc||r.channelURL)&&n("channelInfo"),r.image&&n("uploadLogo"),Object.keys(r).length||j()})};return e.jsxs(i,{display:"flex",flexDirection:"column",alignSelf:"stretch",justifyContent:"center",gap:"spacing-xl",children:[e.jsx(i,{display:"flex",flexDirection:"column",gap:"spacing-sm",children:e.jsxs(i,{display:"flex",flexDirection:"column",gap:"spacing-sm",width:"-webkit-fill-available",children:[e.jsx(Ee,{title:"Amount for Staking",fees:_,showFaucet:!0,showBalance:!0,balance:d,setBalance:p}),e.jsx(Le,{title:"Don\u2019t see Push token in your wallet?"})]})}),e.jsx(i,{display:"flex",justifyContent:"center",children:e.jsx(k,{disabled:d<_||o,onClick:()=>{t()},children:"Create Channel"})})]})},J=({view:n,setView:c,setActiveStepKey:s,handleNextStep:d})=>{const p=f.useRef(),{values:o,setFieldValue:a}=D(),C=async t=>{var b;const r=(b=t.currentTarget.files)==null?void 0:b[0];c(!1),r&&await g(r)},j=async t=>{var b;t.preventDefault(),t.stopPropagation(),c(!1);const r=(b=t.dataTransfer.files)==null?void 0:b[0];r&&await g(r)},g=async t=>{a("image",t);const r=new FileReader;r.readAsDataURL(t),r.onloadend=()=>{a("imageSrc",r.result),a("imageType",t.type)}};return e.jsxs(i,{display:"flex",flexDirection:"column",gap:"spacing-lg",alignItems:"center",alignSelf:"stretch",children:[e.jsxs(i,{display:"flex",flexDirection:"column",alignItems:"center",gap:"spacing-lg",children:[e.jsx(u,{variant:"bes-regular",color:"text-tertiary",children:"Upload a PNG, JPG upto 1MB. Crop the image to resize to 128px."}),e.jsx(me,{id:"file-upload",onChange:C,onDrop:j,children:e.jsxs(i,{width:{initial:"500px",ml:"325px"},padding:"spacing-xxl spacing-none",display:"flex",flexDirection:"column",alignItems:"center",border:"border-sm dashed stroke-tertiary",borderRadius:"radius-md",backgroundColor:"surface-secondary",gap:"spacing-md",children:[o!=null&&o.image?n?e.jsx(i,{width:"128px",height:"128px",borderRadius:"radius-md",children:e.jsx("img",{style:{borderRadius:"inherit"},width:"100%",height:"100%",src:o.image,alt:"Cropped Img"})}):e.jsx(Pe,{width:"200px",height:"200px",imageSrc:o.imageSrc,imageType:o.imageType,onImageCropped:t=>{c(!0),a("image",t)},ref:p}):e.jsx(A,{size:50}),e.jsxs(i,{display:"flex",gap:"spacing-xxxs",children:[e.jsx(u,{variant:"bs-semibold",color:"text-tertiary",children:"Drag and Drop or"}),e.jsx("label",{htmlFor:"file-upload",children:e.jsx(u,{variant:"bs-semibold",color:"text-brand-medium",css:fe`cursor:pointer;`,children:"Browse to Choose"})})]})]})})]}),(o==null?void 0:o.image)&&(n?e.jsx(e.Fragment,{children:e.jsx(k,{disabled:!n&&!(o!=null&&o.image),onClick:()=>{d("stakeFees"),s("stakeFees")},children:"Next"})}):e.jsx(e.Fragment,{children:e.jsx(k,{onClick:()=>{p.current.showCroppedImage()},children:"Crop Image"})}))]})},Y=async({provider:n,account:c})=>{let s=await new ee(P.pushToken,ne.pushToken,n).allowance(c,P.epnscore);s=s==null?void 0:s.toString();const d=ye(s);return Number(d)},E=Ce(_.toString(),18),se=()=>{const{account:n,provider:c,isWalletConnected:s,chainId:d,connect:p}=T(),o=te.coreContractChain===d,{mutate:a}=Te(),{mutate:C}=q(),j=je(),[g,t]=f.useState("channelInfo"),[r,b]=f.useState(["channelInfo"]),L=l=>{b([...new Set([...r,l])]),t(l)},[ie,oe]=f.useState(!1),[$,N]=f.useState(S),[Q,Z]=f.useState(I),x=(l,m,h)=>{N(w=>({...w,progress:l,progressInfo:m,processingInfo:h}))},R=(l,m)=>{Z(h=>({...h,txErrorStatus:l,txError:m}))},le=(l,m)=>{a({noOfTokenToApprove:E,signer:l},{onSuccess:h=>{h.status===1&&(x(60,"Please complete the transaction in your wallet to continue.","Approving PUSH"),X(l,m))},onError:h=>(console.log("Error in approving PUSH Token",h),h.code===4001||h.code==="ACTION_REJECTED"?(console.log("Signature error ",h),R(1,"User Rejected Signature. Please try again.")):R(2,"Transaction failed due to one of the following reasons:"),N(S),!1)})},X=(l,m)=>{let h=ke.GENERAL;const w="1+"+m,v=Se(w);x(70,"Please complete the transaction in your wallet to continue.","Creating Channel..."),C({channelType:h,identityBytes:v,fees:E,signer:l},{onSuccess:y=>{y.status===0?R(2,"Transaction failed due to one of the following reasons:"):(x(80,"Please wait while we confirm the transaction..","Transaction Confirmed.."),setTimeout(()=>{x(90,"Creating your channel, Aligning pixels, adjusting padding... This may take some time.","Redirecting... Please do not refresh")},3e3),setTimeout(()=>{x(100,"Creating your channel, Aligning pixels, adjusting padding... This may take some time.","Redirecting... Please do not refresh"),console.log("Navigating to Channel Dashboard route"),j(`${ve.ChannelDashboard}/${n}`)},5e3))},onError:y=>{console.log("Error in transaction from query >>>>",y),y.code===4001||y.code==="ACTION_REJECTED"?(console.log("Signature error ",y),R(1,"User Rejected Signature. Please try again."),N(S)):(console.error("Error in creating channel--> %o",y),console.error({error:y}),x(0,"There was an error in creating the Channel","Kindly Contact support@epns.io to resolve the issue."))}})},ce=async l=>{if(N(S),Z(I),!s){p();return}x(10,"Checking for PUSH Token Approval","Loading...");const m=await Y({provider:c,account:n}),h=JSON.stringify({name:l.channelName,info:l.channelDesc,url:l.channelURL,icon:l.image});x(20,"Please wait, payload is getting uploaded to IPFS","Loading...");let w=await we(h);console.debug("IPFS storagePointer:",w),x(40,"Please complete the transaction in your wallet to continue.","Payload Uploaded...");var v=c.getSigner(n);console.debug(v),m<50?le(v,w):X(v,w)};return e.jsx(M,{onSubmit:l=>ce(l),children:e.jsxs(i,{padding:{initial:"spacing-lg",ml:"spacing-sm"},backgroundColor:"surface-primary",borderRadius:"radius-md",display:"flex",width:{initial:"648px",ml:"325px"},flexDirection:"column",alignItems:"center",gap:"spacing-xl",children:[e.jsx(V,{}),!o&&e.jsx(W,{}),o&&e.jsxs(e.Fragment,{children:[Q.txErrorStatus!==0&&e.jsx(be,{variant:"error",icon:e.jsx(_e,{color:"icon-state-danger-bold",size:24}),message:Q.txError,width:"100%"}),$.progress?e.jsx(H,{progressState:$}):e.jsxs(i,{display:"flex",flexDirection:"column",gap:"spacing-lg",alignItems:"center",alignSelf:"stretch",children:[e.jsx(Re,{steps:G,completedSteps:r,setActiveStepKey:l=>t(l)}),g=="channelInfo"&&e.jsx(O,{handleNextStep:L,setActiveStepKey:t}),g==="uploadLogo"&&e.jsx(J,{view:ie,setView:oe,setActiveStepKey:t,handleNextStep:L}),g==="stakeFees"&&e.jsx(z,{handleNextStep:L})]})]})]})})}});export{se as C,We as __tla};

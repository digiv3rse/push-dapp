import{m as e,B as a,eh as s,F as de,e5 as z,e6 as P,e4 as H,z as ke,dF as Ce,fR as F,ei as R,fS as be,dG as we,x as he,r as u,D as pe,fT as ve,fU as ge,fV as Se,dH as _e,dJ as Te,fW as Ie,fX as De,fY as Pe,fZ as Re,f_ as Ee,f$ as Ne,g0 as Ue,__tla as Fe}from"./index-DVrWTDQT.js";import{c as ue,a as M,b as Le,u as xe,__tla as Ae}from"./index.esm-jC8m0QCs.js";import{U as Oe,m as Ve,c as ze,i as He,__tla as Me}from"./UniswapWidget-A20aI0ZE.js";import{t as Be,h as qe,I as Ge,__tla as We}from"./LogoSizeHelper-BaeJiIlz.js";import{E as Je,__tla as Ye}from"./ErrorFilled-7lCH7Pan.js";import{u as me,__tla as Ke}from"./useMutation-Cn4lyfcW.js";import{C as $e,__tla as Xe}from"./ContentLayout-BHsC3zdH.js";import{__tla as Ze}from"./slicedToArray-zr8-PhwI.js";import{__tla as Qe}from"./index.es-JyG5W_vu.js";import"./browser-CeceZ__e.js";let fe,er=Promise.all([(()=>{try{return Fe}catch{}})(),(()=>{try{return Ae}catch{}})(),(()=>{try{return Me}catch{}})(),(()=>{try{return We}catch{}})(),(()=>{try{return Ye}catch{}})(),(()=>{try{return Ke}catch{}})(),(()=>{try{return Xe}catch{}})(),(()=>{try{return Ze}catch{}})(),(()=>{try{return Qe}catch{}})()]).then(async()=>{let B,q,G,W,J,Y,K,E,$,X,L,Z,Q,ee,re,ne,ae,te,se,oe,A,O,I,V,ie;B=({steps:r,setActiveStepIndex:t,completedSteps:n})=>{const i=c=>{n!=null&&n.includes(c)&&t(c)};return e.jsx(a,{display:"flex",gap:"s8",width:"-webkit-fill-available",children:r.map((c,g)=>e.jsxs(a,{display:"flex",flexDirection:"column",gap:"s3",width:"inherit",cursor:"pointer",color:n.includes(g)?"pink-500":"gray-500",onClick:()=>i(g),children:[e.jsx(s,{textAlign:"center",variant:"h5-semibold",display:{ml:"none",dp:"block"},children:c.label}),e.jsx(s,{textAlign:"center",variant:"h6-semibold",display:{ml:"block",dp:"none"},children:c.label}),e.jsx(a,{height:"4px",borderRadius:"r2",backgroundColor:n.includes(g)?"pink-500":"gray-500"})]},g))})},q=r=>{const{svgProps:t,...n}=r;return e.jsx(de,{componentName:"CloudUpload",icon:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"inherit",height:"inherit",viewBox:"0 0 53 52",fill:"none",...t,children:[e.jsx("path",{d:"M16.1888 26.3978L26.7966 15.7901L37.4043 26.3978",stroke:"#C4CBD5","stroke-width":"2.5","stroke-linecap":"round","stroke-linejoin":"round"}),e.jsx("path",{d:"M27.0618 50.0001V16.8509",stroke:"#C4CBD5","stroke-width":"2.5","stroke-linecap":"round","stroke-linejoin":"round"}),e.jsx("path",{d:"M21.4927 35.4144H11.1502C8.05625 35.0608 1.86841 32.4972 1.86841 25.0718C1.86841 17.6464 8.05625 14.9061 11.1502 14.4641C11.769 10.3094 15.6585 2 26.2662 2C39.2607 2 41.0286 10.8398 41.9126 16.0553C45.0065 15.9669 51.4596 19.2906 51.4596 26.9282C51.2828 29.7569 49.6032 35.4144 44.2993 35.4144C38.9955 35.4144 34.1336 35.4144 32.3656 35.4144",stroke:"#C4CBD5","stroke-width":"2.5","stroke-linecap":"round","stroke-linejoin":"round"})]}),...n})},G=r=>{const{svgProps:t,...n}=r;return e.jsx(de,{componentName:"Swap",icon:e.jsxs("svg",{width:"inherit",height:"inherit",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t,children:[e.jsx("path",{d:"M13.25 5L5 13.25H27",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e.jsx("path",{d:"M18.75 27L27 18.75H5",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})]}),...n})},W=async r=>{const{channelType:t,identityBytes:n,fees:i,signer:c}=r;return(await new z(P.epnscore,H.epnscore,c).createChannelWithPUSH(t,n,i,0,{gasLimit:6e5})).wait()},J=async r=>{const{noOfTokenToApprove:t,signer:n}=r;return(await new z(P.pushToken,H.pushToken,n).approve(P.epnscore,t)).wait()},Y=({mintPushToken:r,noOfPushTokensToCheck:t,mintingPush:n})=>{const i=ke.appEnv==="prod",{isModalOpen:c,showModal:g,ModalComponent:b}=Ce();return e.jsxs(a,{display:"flex",padding:"s4 s6",backgroundColor:"pink-200",borderRadius:"r0 r0 r4 r4",justifyContent:"space-between",alignItems:"center",flexDirection:{ml:"column",initial:"row"},gap:"s3",children:[e.jsx(F,{isLoading:n,children:e.jsx(s,{variant:"c-regular",color:"gray-1000",children:i?"Your balance is low. Swap to get PUSH Tokens.":"Follow these steps to get Testnet PUSH."})}),i?e.jsx(R,{size:"extraSmall",leadingIcon:e.jsx(G,{}),onClick:g,children:"Swap PUSH Token"}):e.jsxs(a,{display:"flex",gap:"s3",children:[e.jsx(F,{isLoading:n,children:e.jsx(be,{to:"https://chaindrop.org/?chainid=11155111&token=0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",target:"_blank",children:e.jsxs(a,{display:"flex",gap:"s2",alignItems:"baseline",color:"pink-600",cursor:"pointer",children:[e.jsx(a,{border:"1px solid pink-600",width:"16px",height:"15px",borderRadius:"r10",display:"flex",justifyContent:"center",children:e.jsx(s,{variant:"c-regular",children:"1"})}),e.jsx(s,{children:"Sepolia ETH Faucet"})]})})}),e.jsx(F,{isLoading:n,children:e.jsxs(a,{display:"flex",gap:"s2",alignItems:"baseline",color:"pink-600",cursor:"pointer",onClick:()=>r(1e3),children:[e.jsx(a,{border:"1px solid pink-600",width:"16px",height:"15px",borderRadius:"r10",display:"flex",justifyContent:"center",children:e.jsx(s,{variant:"c-regular",children:"2"})}),e.jsx(s,{children:"Get Testnet Push"})]})})]}),c&&e.jsx(b,{InnerComponent:Oe,InnerComponentProps:{defaultPushTokenAmount:t},modalPadding:"0px",modalPosition:we.ON_ROOT})]})},K=[{label:"Channel Info"},{label:"Upload Logo"},{label:"Stake Fees"}],E=50,$=({channelStakeFees:r,handleCreateNewChannel:t})=>{const n=E,{provider:i,account:c,isWalletConnected:g,connect:b}=he(),[y,h]=u.useState(0),[m,x]=u.useState(!1),[S,l]=u.useState(!1),o=async _=>{if(g||b(),g){x(!0);try{const T=await Ve({noOfTokens:_,provider:i,account:c});x(!1),h(T)}catch(T){console.log("Error >>",T),x(!1)}}},f=async()=>{l(!0);const _=await ze({address:c,provider:i});l(!1),h(_)};u.useEffect(()=>{f()},[y,c]);const N=async()=>{g&&await He()},w=u.useMemo(()=>y<n,[y]);return e.jsxs(a,{display:"flex",flexDirection:"column",alignSelf:"stretch",justifyContent:"center",gap:"s10",children:[e.jsxs(a,{display:"flex",flexDirection:"column",gap:"s4",children:[e.jsxs(a,{display:"flex",flexDirection:"column",alignSelf:"stretch",children:[e.jsxs(a,{display:"flex",flexDirection:"row",justifyContent:"space-between",backgroundColor:{light:"gray-100",dark:"gray-1000"},borderRadius:w?"r4 r4 r0 r0":"r4",padding:"s4 s6",alignItems:"center",children:[e.jsx(s,{variant:"h4-semibold",color:{light:"gray-1000",dark:"gray-100"},display:{ml:"none",dp:"block"},children:"Amout For Staking"}),e.jsx(s,{variant:"h5-semibold",color:{light:"gray-1000",dark:"gray-100"},display:{ml:"block",dp:"none"},children:"Amout For Staking"}),e.jsxs(a,{children:[e.jsxs(s,{variant:"h4-semibold",color:{light:"pink-500",dark:"pink-400"},children:[r," PUSH"]}),e.jsx(F,{isLoading:S,children:e.jsxs(s,{variant:"bes-semibold",color:"gray-500",children:["Balance: ",y==null?void 0:y.toLocaleString()]})})]})]}),w&&e.jsx(Y,{mintPushToken:o,noOfPushTokensToCheck:50,mintingPush:m})]}),e.jsxs(a,{display:"flex",flexDirection:"row",gap:"s1",justifyContent:"center",children:[e.jsx(s,{variant:"bes-semibold",color:"gray-500",children:"Don't see Push token in your wallet?"}),e.jsx(s,{css:pe`
              cursor: pointer;
            `,variant:"bes-semibold",color:"pink-500",onClick:N,children:"Import Token"})]})]}),e.jsx(a,{display:"flex",justifyContent:"center",children:e.jsx(R,{onClick:()=>{t()},children:"Create Channel"})})]})},X=ue().shape({channelName:M().required("Required"),channelDesc:M().required("Required"),channelURL:M().required("Required").test("url","Invalid URL",function(r){return new RegExp("^((?:https|http):\\/\\/)((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(r)})}),L=r=>r.type.startsWith("image/"),Z=async({provider:r,account:t})=>{let n=await new z(P.pushToken,H.pushToken,r).allowance(t,P.epnscore);n=n==null?void 0:n.toString();const i=ve(n);return console.log("Number value >>>",i,Number(i)),Number(i)},Q=(r,t)=>{console.log("Cropped Image",r),Be(r,function(n){qe(n).success&&(console.log("Cropped Image....",r),t(r))})},ee=({view:r,croppedImage:t,setView:n,setCroppedImage:i,setActiveStepIndex:c,handleNextStep:g})=>{const b=u.useRef(),y=ue().shape({image:Le().required("Image is required")}),h=xe({initialValues:{image:null,imageSrc:"",imageType:""},validationSchema:y,onSubmit:l=>{}}),m=async l=>{var f;console.log("File change");const o=(f=l.currentTarget.files)==null?void 0:f[0];n(!1),i(void 0),o&&L(o)&&await S(o)},x=async l=>{var f;l.preventDefault(),l.stopPropagation(),n(!1),i(void 0);const o=(f=l.dataTransfer.files)==null?void 0:f[0];o&&L(o)&&await S(o)},S=async l=>{h.setFieldValue("image",l);const o=new FileReader;o.readAsDataURL(l),o.onloadend=()=>{h.setFieldValue("imageSrc",o.result),h.setFieldValue("imageType",l.type)},n(!0)};return e.jsxs(a,{display:"flex",flexDirection:"column",gap:"s8",alignItems:"center",alignSelf:"stretch",children:[e.jsxs(a,{display:"flex",flexDirection:"column",alignItems:"center",gap:"s8",children:[e.jsx(s,{variant:"bes-regular",color:"gray-500",children:"Upload a PNG, JPG upto 1MB. Crop the image to resize to 128px."}),e.jsx("form",{onSubmit:h.handleSubmit,children:e.jsxs(a,{width:{initial:"500px",ml:"325px"},padding:"s12 s0",display:"flex",flexDirection:"column",alignItems:"center",border:{light:"1px dashed gray-300",dark:"1px dashed gray-700"},borderRadius:"r6",backgroundColor:{light:"gray-100",dark:"gray-1000"},gap:"s6",onDragOver:l=>l.preventDefault(),onDrop:x,children:[r?t?e.jsx(a,{width:"128px",height:"128px",borderRadius:"r5",children:e.jsx("img",{style:{borderRadius:"inherit"},width:"100%",height:"100%",src:t,alt:"Cropped Img"})}):e.jsx(Ge,{width:"200px",height:"200px",imageSrc:h.values.imageSrc,imageType:h.values.imageType,onImageCropped:l=>i(l),ref:b}):e.jsx(q,{size:50}),e.jsxs(a,{display:"flex",gap:"s1",children:[e.jsx(s,{variant:"bs-semibold",color:{light:"gray-1000",dark:"gray-600"},children:" Drag and Drop or"}),e.jsx("label",{htmlFor:"file-upload",children:e.jsx(s,{variant:"bs-semibold",color:{light:"pink-600",dark:"pink-400"},css:pe`cursor:pointer;`,children:"Browse to Choose"})})]}),e.jsx("input",{id:"file-upload",accept:"image/*",name:"file-upload",hidden:!0,onChange:m,type:"file",readOnly:!0})]})})]}),!t&&r?e.jsx(R,{onClick:()=>{b.current.showCroppedImage()},children:"Crop Image"}):e.jsx(R,{disabled:!r&&!t,onClick:()=>{g(),c(2)},children:"Next"})]})},re=({channelInfoFormik:r})=>e.jsx(a,{display:"flex",flexDirection:"column",alignItems:"center",gap:"s10",alignSelf:"stretch",children:e.jsx(a,{display:"flex",flexDirection:"column",gap:"s4",alignSelf:"stretch",children:e.jsx("form",{onSubmit:r.handleSubmit,children:e.jsxs(a,{display:"flex",flexDirection:"column",gap:"s4",alignSelf:"stretch",children:[e.jsx(ge,{required:!0,label:"Channel Name",value:r.values.channelName,onChange:t=>{const n=t.target.value.slice(0,32);r.setFieldValue("channelName",n)},error:r.touched.channelName&&!!r.errors.channelName,errorMessage:r.touched.channelName?r.errors.channelName:"",totalCount:32}),e.jsx(Se,{required:!0,label:"Channel Description",placeholder:"Get notified about ...",description:"Enter a Brief description of the notifications the user will receive",error:r.touched.channelDesc&&!!r.errors.channelDesc,errorMessage:r.touched.channelDesc?r.errors.channelDesc:"",totalCount:250,value:r.values.channelDesc,onChange:t=>{const n=t.target.value.slice(0,250);r.setFieldValue("channelDesc",n)}}),e.jsx(ge,{required:!0,label:"Channel Website URL",value:r.values.channelURL,onChange:r.handleChange("channelURL"),error:r.touched.channelURL&&!!r.errors.channelURL,errorMessage:r.touched.channelURL?r.errors.channelURL:""}),e.jsx(a,{display:"flex",justifyContent:"center",children:e.jsx(R,{disabled:!r.isValid,children:"Next"})})]})})})}),ne=({channelCreationError:r})=>e.jsxs(a,{gap:"s2",display:"flex",flexDirection:"row",backgroundColor:{light:"red-100",dark:"red-800"},borderRadius:"r4",padding:{ml:"s2",lp:"s2",initial:"s2"},width:"100%",children:[e.jsx(Je,{color:{light:"red-600",dark:"red-300"},size:24}),e.jsxs(a,{color:{light:"red-700",dark:"red-300"},children:[e.jsx(s,{variant:"h5-semibold",color:{light:"red-700",dark:"red-300"},children:r.txError}),r.txErrorStatus===2&&e.jsxs(e.Fragment,{children:[e.jsx(s,{variant:"bs-regular",children:"1. Not enough Push tokens in your wallet."}),e.jsx(s,{variant:"bs-regular",children:"2. Gas price increased due to network congestion. Adjust gas limit manually."})]})]})]}),ae=()=>e.jsxs(a,{display:"flex",flexDirection:"column",alignItems:"center",gap:"s1",alignSelf:"stretch",children:[e.jsx(s,{variant:"h3-semibold",color:{light:"gray-1000",dark:"gray-100"},display:{ml:"none",dp:"block"},children:"Create Your Channel"}),e.jsx(s,{variant:"bs-regular",color:{light:"gray-500",dark:"gray-600"},display:{ml:"none",dp:"block"},children:"Creating your own notification channel to manage, send and notify users."}),e.jsx(s,{variant:"h4-semibold",color:{light:"gray-1000",dark:"gray-100"},display:{ml:"block",dp:"none"},children:"Create Your Channel"}),e.jsx(s,{variant:"bes-regular",color:{light:"gray-500",dark:"gray-600"},display:{ml:"block",dp:"none"},textAlign:"center",children:"Creating your own notification channel to manage, send and notify users."})]}),te=({progressState:r})=>e.jsxs(a,{display:"flex",flexDirection:"column",alignSelf:"stretch",gap:"s10",alignItems:"center",children:[e.jsx(a,{padding:"s6",backgroundColor:{light:"gray-100",dark:"gray-1000"},borderRadius:"r4",width:"-webkit-fill-available",children:e.jsx(s,{textAlign:"center",variant:"h5-semibold",color:"pink-600",children:r.progressInfo})}),e.jsx(a,{width:"400px",children:e.jsx(_e,{percent:r.progress,color:"#D548EC",backgroundColor:"#F3AEFF",height:"4px"})}),e.jsxs(a,{display:"flex",flexDirection:"row",alignItems:"center",gap:"s1",children:[e.jsx(Te,{type:Ie.PROCESSING,size:16}),e.jsx(s,{variant:"bs-semibold",color:{light:"gray-800",dark:"gray-300"},children:r.processingInfo})]})]}),se=()=>me({mutationKey:[De],mutationFn:J}),oe=()=>me({mutationKey:[Pe],mutationFn:W}),A=[0],O=Re(E.toString(),18),I={progress:null,progressInfo:"",processingInfo:""},V={txErrorStatus:0,txError:""},ie=()=>{const{account:r,provider:t,isWalletConnected:n,connect:i}=he(),{mutate:c,isPending:g}=se(),{mutate:b,isPending:y}=oe(),[h,m]=u.useState(0),x=xe({initialValues:{channelName:"",channelDesc:"",channelURL:""},validationSchema:X,onSubmit:d=>{console.log("Values ",d),le(),m(1)}}),[S,l]=u.useState(!1),[o,f]=u.useState(void 0),[N,w]=u.useState(I),[_,T]=u.useState(V),le=()=>{if(h<2){const d=h+1;A.push(d),m(d)}};u.useEffect(()=>{o&&Q(o,f)},[o]);const j=(d,k,p)=>{w(v=>({...v,progress:d,progressInfo:k,processingInfo:p}))},U=(d,k)=>{T(p=>({...p,txErrorStatus:d,txError:k}))},ye=(d,k)=>{c({noOfTokenToApprove:O,signer:d},{onSuccess:p=>{p.status===1&&(j(60,"Please complete the transaction in your wallet to continue.","Approving PUSH"),ce(d,k))},onError:p=>(console.log("Error in approving PUSH Token",p),p.code===4001||p.code==="ACTION_REJECTED"?(console.log("Signature error ",p),U(1,"User Rejected Signature. Please try again.")):U(2,"Transaction failed due to one of the following reasons:"),w(I),!1)})},ce=(d,k)=>{let p=Ue.GENERAL;const v="1+"+k,D=Ne(v);j(70,"Please complete the transaction in your wallet to continue.","Creating Channel..."),b({channelType:p,identityBytes:D,fees:O,signer:d},{onSuccess:C=>{C.status===0?U(2,"Transaction failed due to one of the following reasons:"):(console.log("Tx Successful",C),j(80,"Please wait while we confirm the transaction..","Transaction Confirmed.."),setTimeout(()=>{j(90,"Creating your channel, Aligning pixels, adjusting padding... This may take some time.","Redirecting... Please do not refresh")},2e3),setTimeout(()=>{j(100,"Creating your channel, Aligning pixels, adjusting padding... This may take some time.","Redirecting... Please do not refresh"),window.location.reload()},3e3))},onError:C=>{console.log("Error in transaction from query >>>>",C),C.code===4001||C.code==="ACTION_REJECTED"?(console.log("Signature error ",C),U(1,"User Rejected Signature. Please try again."),w(I)):(console.error("Error --> %o",C),console.error({error:C}),j(0,"There was an error in creating the Channel","Kindly Contact support@epns.io to resolve the issue."))}})},je=async()=>{if(w(I),T(V),!n){i();return}if(!x.isValid){m(0);return}if(!o){m(1);return}j(10,"Checking for PUSH Token Approval","Loading...");const d=await Z({provider:t,account:r});console.log("Approved Token Amount >>",d);let k={name:x.values.channelName,info:x.values.channelDesc,url:x.values.channelURL,icon:o};const p=JSON.stringify(k);j(20,"Please wait, payload is getting uploaded to IPFS","Loading...");let v=await Ee(p);console.debug("IPFS storagePointer:",v),j(40,"Please complete the transaction in your wallet to continue.","Payload Uploaded...");var D=t.getSigner(r);console.debug(D),d<50?ye(D,v):ce(D,v)};return e.jsxs(a,{padding:{initial:"s8",ml:"s4"},backgroundColor:{light:"white",dark:"gray-900"},borderRadius:"r8",display:"flex",flexDirection:"column",alignItems:"center",gap:"s10",children:[e.jsx(ae,{}),_.txErrorStatus!==0&&e.jsx(ne,{channelCreationError:_}),N.progress===null?e.jsxs(a,{display:"flex",flexDirection:"column",gap:"s8",alignItems:"center",alignSelf:"stretch",children:[e.jsx(B,{steps:K,completedSteps:A,setActiveStepIndex:m}),h==0&&e.jsx(re,{channelInfoFormik:x}),h===1&&e.jsx(ee,{view:S,croppedImage:o,setView:l,setCroppedImage:f,setActiveStepIndex:m,handleNextStep:le}),h===2&&e.jsx($,{channelStakeFees:E,handleCreateNewChannel:je})]}):e.jsx(te,{progressState:N})]})},fe=()=>e.jsx($e,{children:e.jsx(ie,{})})});export{er as __tla,fe as default};

import{m as e,B as a,eh as s,F as xe,e5 as z,e6 as R,e4 as H,z as M,dF as ve,fR as U,ei as I,fS as Se,dG as _e,x as q,r as g,D as me,fT as Ie,fU as fe,fV as Te,dH as De,dJ as Pe,fW as Re,fX as Ee,fY as Ne,fZ as Fe,f_ as Ue,f$ as Le,g0 as Ae,__tla as Oe}from"./index-CAoYq-L-.js";import{c as ye,a as B,b as Ve,u as je,__tla as ze}from"./index.esm-CFGfbDtR.js";import{U as He,m as Me,c as qe,i as Be,__tla as Ge}from"./UniswapWidget-D9dfjcNJ.js";import{t as We,h as Je,I as Ye,__tla as Ke}from"./LogoSizeHelper-CkFd--hF.js";import{E as $e,__tla as Xe}from"./ErrorFilled-WrTAvBXA.js";import{u as ke,__tla as Ze}from"./useMutation-B6wYRxow.js";import{C as Qe,__tla as er}from"./ContentLayout-BX8pdu_L.js";import{__tla as rr}from"./slicedToArray-C_DoOpUZ.js";import{__tla as nr}from"./index.es-C0cAJ-Ub.js";import"./browser-CeceZ__e.js";let Ce,ar=Promise.all([(()=>{try{return Oe}catch{}})(),(()=>{try{return ze}catch{}})(),(()=>{try{return Ge}catch{}})(),(()=>{try{return Ke}catch{}})(),(()=>{try{return Xe}catch{}})(),(()=>{try{return Ze}catch{}})(),(()=>{try{return er}catch{}})(),(()=>{try{return rr}catch{}})(),(()=>{try{return nr}catch{}})()]).then(async()=>{let G,W,J,Y,K,$,X,E,Z,Q,L,ee,re,ne,ae,te,se,ie,oe,le,ce,A,O,T,V,de;G=({steps:r,setActiveStepIndex:t,completedSteps:n})=>{const o=l=>{n!=null&&n.includes(l)&&t(l)};return e.jsx(a,{display:"flex",gap:"s8",width:"-webkit-fill-available",children:r.map((l,h)=>e.jsxs(a,{display:"flex",flexDirection:"column",gap:"s3",width:"inherit",cursor:"pointer",color:n.includes(h)?"pink-500":"gray-500",onClick:()=>o(h),children:[e.jsx(s,{textAlign:"center",variant:"h5-semibold",display:{ml:"none",dp:"block"},children:l.label}),e.jsx(s,{textAlign:"center",variant:"h6-semibold",display:{ml:"block",dp:"none"},children:l.label}),e.jsx(a,{height:"4px",borderRadius:"r2",backgroundColor:n.includes(h)?"pink-500":"gray-500"})]},h))})},W=r=>{const{svgProps:t,...n}=r;return e.jsx(xe,{componentName:"CloudUpload",icon:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"inherit",height:"inherit",viewBox:"0 0 53 52",fill:"none",...t,children:[e.jsx("path",{d:"M16.1888 26.3978L26.7966 15.7901L37.4043 26.3978",stroke:"#C4CBD5","stroke-width":"2.5","stroke-linecap":"round","stroke-linejoin":"round"}),e.jsx("path",{d:"M27.0618 50.0001V16.8509",stroke:"#C4CBD5","stroke-width":"2.5","stroke-linecap":"round","stroke-linejoin":"round"}),e.jsx("path",{d:"M21.4927 35.4144H11.1502C8.05625 35.0608 1.86841 32.4972 1.86841 25.0718C1.86841 17.6464 8.05625 14.9061 11.1502 14.4641C11.769 10.3094 15.6585 2 26.2662 2C39.2607 2 41.0286 10.8398 41.9126 16.0553C45.0065 15.9669 51.4596 19.2906 51.4596 26.9282C51.2828 29.7569 49.6032 35.4144 44.2993 35.4144C38.9955 35.4144 34.1336 35.4144 32.3656 35.4144",stroke:"#C4CBD5","stroke-width":"2.5","stroke-linecap":"round","stroke-linejoin":"round"})]}),...n})},J=r=>{const{svgProps:t,...n}=r;return e.jsx(xe,{componentName:"Swap",icon:e.jsxs("svg",{width:"inherit",height:"inherit",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t,children:[e.jsx("path",{d:"M13.25 5L5 13.25H27",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e.jsx("path",{d:"M18.75 27L27 18.75H5",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})]}),...n})},Y=async r=>{const{channelType:t,identityBytes:n,fees:o,signer:l}=r;return(await new z(R.epnscore,H.epnscore,l).createChannelWithPUSH(t,n,o,0,{gasLimit:6e5})).wait()},K=async r=>{const{noOfTokenToApprove:t,signer:n}=r;return(await new z(R.pushToken,H.pushToken,n).approve(R.epnscore,t)).wait()},$=({mintPushToken:r,noOfPushTokensToCheck:t,mintingPush:n})=>{const o=M.appEnv==="prod",{isModalOpen:l,showModal:h,ModalComponent:b}=ve();return e.jsxs(a,{display:"flex",padding:"s4 s6",backgroundColor:"pink-200",borderRadius:"r0 r0 r4 r4",justifyContent:"space-between",alignItems:"center",flexDirection:{ml:"column",initial:"row"},gap:"s3",children:[e.jsx(U,{isLoading:n,children:e.jsx(s,{variant:"c-regular",color:"gray-1000",children:o?"Your balance is low. Swap to get PUSH Tokens.":"Follow these steps to get Testnet PUSH."})}),o?e.jsx(I,{size:"extraSmall",leadingIcon:e.jsx(J,{}),onClick:h,children:"Swap PUSH Token"}):e.jsxs(a,{display:"flex",gap:"s3",children:[e.jsx(U,{isLoading:n,children:e.jsx(Se,{to:"https://chaindrop.org/?chainid=11155111&token=0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",target:"_blank",children:e.jsxs(a,{display:"flex",gap:"s2",alignItems:"baseline",color:"pink-600",cursor:"pointer",children:[e.jsx(a,{border:"1px solid pink-600",width:"16px",height:"15px",borderRadius:"r10",display:"flex",justifyContent:"center",children:e.jsx(s,{variant:"c-regular",children:"1"})}),e.jsx(s,{children:"Sepolia ETH Faucet"})]})})}),e.jsx(U,{isLoading:n,children:e.jsxs(a,{display:"flex",gap:"s2",alignItems:"baseline",color:"pink-600",cursor:"pointer",onClick:()=>r(1e3),children:[e.jsx(a,{border:"1px solid pink-600",width:"16px",height:"15px",borderRadius:"r10",display:"flex",justifyContent:"center",children:e.jsx(s,{variant:"c-regular",children:"2"})}),e.jsx(s,{children:"Get Testnet Push"})]})})]}),l&&e.jsx(b,{InnerComponent:He,InnerComponentProps:{defaultPushTokenAmount:t},modalPadding:"0px",modalPosition:_e.ON_ROOT})]})},X=[{label:"Channel Info"},{label:"Upload Logo"},{label:"Stake Fees"}],E=50,Z=({channelStakeFees:r,handleCreateNewChannel:t})=>{const n=E,{provider:o,account:l,isWalletConnected:h,connect:b}=q(),[f,u]=g.useState(0),[N,x]=g.useState(!1),[m,i]=g.useState(!1),d=async _=>{if(h||b(),h){x(!0);try{const v=await Me({noOfTokens:_,provider:o,account:l});x(!1),u(v)}catch(v){console.log("Error >>",v),x(!1)}}},y=async()=>{i(!0);const _=await qe({address:l,provider:o});i(!1),u(_)};g.useEffect(()=>{y()},[f,l]);const w=async()=>{h&&await Be()},D=g.useMemo(()=>f<n,[f]);return e.jsxs(a,{display:"flex",flexDirection:"column",alignSelf:"stretch",justifyContent:"center",gap:"s10",children:[e.jsxs(a,{display:"flex",flexDirection:"column",gap:"s4",children:[e.jsxs(a,{display:"flex",flexDirection:"column",alignSelf:"stretch",children:[e.jsxs(a,{display:"flex",flexDirection:"row",justifyContent:"space-between",backgroundColor:{light:"gray-100",dark:"gray-1000"},borderRadius:D?"r4 r4 r0 r0":"r4",padding:"s4 s6",alignItems:"center",children:[e.jsx(s,{variant:"h4-semibold",color:{light:"gray-1000",dark:"gray-100"},display:{ml:"none",dp:"block"},children:"Amout For Staking"}),e.jsx(s,{variant:"h5-semibold",color:{light:"gray-1000",dark:"gray-100"},display:{ml:"block",dp:"none"},children:"Amout For Staking"}),e.jsxs(a,{children:[e.jsxs(s,{variant:"h4-semibold",color:{light:"pink-500",dark:"pink-400"},children:[r," PUSH"]}),e.jsx(U,{isLoading:m,children:e.jsxs(s,{variant:"bes-semibold",color:"gray-500",children:["Balance: ",f==null?void 0:f.toLocaleString()]})})]})]}),D&&e.jsx($,{mintPushToken:d,noOfPushTokensToCheck:50,mintingPush:N})]}),e.jsxs(a,{display:"flex",flexDirection:"row",gap:"s1",justifyContent:"center",children:[e.jsx(s,{variant:"bes-semibold",color:"gray-500",children:"Don't see Push token in your wallet?"}),e.jsx(s,{css:me`
              cursor: pointer;
            `,variant:"bes-semibold",color:"pink-500",onClick:w,children:"Import Token"})]})]}),e.jsx(a,{display:"flex",justifyContent:"center",children:e.jsx(I,{onClick:()=>{t()},children:"Create Channel"})})]})},Q=ye().shape({channelName:B().required("Required"),channelDesc:B().required("Required"),channelURL:B().required("Required").test("url","Invalid URL",function(r){return new RegExp("^((?:https|http):\\/\\/)((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(r)})}),L=r=>r.type.startsWith("image/"),ee=async({provider:r,account:t})=>{let n=await new z(R.pushToken,H.pushToken,r).allowance(t,R.epnscore);n=n==null?void 0:n.toString();const o=Ie(n);return console.log("Number value >>>",o,Number(o)),Number(o)},re=(r,t)=>{console.log("Cropped Image",r),We(r,function(n){Je(n).success&&(console.log("Cropped Image....",r),t(r))})},ne=({view:r,croppedImage:t,setView:n,setCroppedImage:o,setActiveStepIndex:l,handleNextStep:h})=>{const b=g.useRef(),f=ye().shape({image:Ve().required("Image is required")}),u=je({initialValues:{image:null,imageSrc:"",imageType:""},validationSchema:f,onSubmit:i=>{}}),N=async i=>{var y;console.log("File change");const d=(y=i.currentTarget.files)==null?void 0:y[0];n(!1),o(void 0),d&&L(d)&&await m(d)},x=async i=>{var y;i.preventDefault(),i.stopPropagation(),n(!1),o(void 0);const d=(y=i.dataTransfer.files)==null?void 0:y[0];d&&L(d)&&await m(d)},m=async i=>{u.setFieldValue("image",i);const d=new FileReader;d.readAsDataURL(i),d.onloadend=()=>{u.setFieldValue("imageSrc",d.result),u.setFieldValue("imageType",i.type)},n(!0)};return e.jsxs(a,{display:"flex",flexDirection:"column",gap:"s8",alignItems:"center",alignSelf:"stretch",children:[e.jsxs(a,{display:"flex",flexDirection:"column",alignItems:"center",gap:"s8",children:[e.jsx(s,{variant:"bes-regular",color:"gray-500",children:"Upload a PNG, JPG upto 1MB. Crop the image to resize to 128px."}),e.jsx("form",{onSubmit:u.handleSubmit,children:e.jsxs(a,{width:{initial:"500px",ml:"325px"},padding:"s12 s0",display:"flex",flexDirection:"column",alignItems:"center",border:{light:"1px dashed gray-300",dark:"1px dashed gray-700"},borderRadius:"r6",backgroundColor:{light:"gray-100",dark:"gray-1000"},gap:"s6",onDragOver:i=>i.preventDefault(),onDrop:x,children:[r?t?e.jsx(a,{width:"128px",height:"128px",borderRadius:"r5",children:e.jsx("img",{style:{borderRadius:"inherit"},width:"100%",height:"100%",src:t,alt:"Cropped Img"})}):e.jsx(Ye,{width:"200px",height:"200px",imageSrc:u.values.imageSrc,imageType:u.values.imageType,onImageCropped:i=>o(i),ref:b}):e.jsx(W,{size:50}),e.jsxs(a,{display:"flex",gap:"s1",children:[e.jsx(s,{variant:"bs-semibold",color:{light:"gray-1000",dark:"gray-600"},children:" Drag and Drop or"}),e.jsx("label",{htmlFor:"file-upload",children:e.jsx(s,{variant:"bs-semibold",color:{light:"pink-600",dark:"pink-400"},css:me`cursor:pointer;`,children:"Browse to Choose"})})]}),e.jsx("input",{id:"file-upload",accept:"image/*",name:"file-upload",hidden:!0,onChange:N,type:"file",readOnly:!0})]})})]}),!t&&r?e.jsx(I,{onClick:()=>{b.current.showCroppedImage()},children:"Crop Image"}):e.jsx(I,{disabled:!r&&!t,onClick:()=>{h(),l(2)},children:"Next"})]})},ae=({channelInfoFormik:r})=>e.jsx(a,{display:"flex",flexDirection:"column",alignItems:"center",gap:"s10",alignSelf:"stretch",children:e.jsx(a,{display:"flex",flexDirection:"column",gap:"s4",alignSelf:"stretch",children:e.jsx("form",{onSubmit:r.handleSubmit,children:e.jsxs(a,{display:"flex",flexDirection:"column",gap:"s4",alignSelf:"stretch",children:[e.jsx(fe,{required:!0,label:"Channel Name",value:r.values.channelName,onChange:t=>{const n=t.target.value.slice(0,32);r.setFieldValue("channelName",n)},error:r.touched.channelName&&!!r.errors.channelName,errorMessage:r.touched.channelName?r.errors.channelName:"",totalCount:32}),e.jsx(Te,{required:!0,label:"Channel Description",placeholder:"Get notified about ...",description:"Enter a Brief description of the notifications the user will receive",error:r.touched.channelDesc&&!!r.errors.channelDesc,errorMessage:r.touched.channelDesc?r.errors.channelDesc:"",totalCount:250,value:r.values.channelDesc,onChange:t=>{const n=t.target.value.slice(0,250);r.setFieldValue("channelDesc",n)}}),e.jsx(fe,{required:!0,label:"Channel Website URL",value:r.values.channelURL,onChange:r.handleChange("channelURL"),error:r.touched.channelURL&&!!r.errors.channelURL,errorMessage:r.touched.channelURL?r.errors.channelURL:""}),e.jsx(a,{display:"flex",justifyContent:"center",children:e.jsx(I,{disabled:!r.isValid,children:"Next"})})]})})})}),te=({channelCreationError:r})=>e.jsxs(a,{gap:"s2",display:"flex",flexDirection:"row",backgroundColor:{light:"red-100",dark:"red-800"},borderRadius:"r4",padding:{ml:"s2",lp:"s2",initial:"s2"},width:"100%",children:[e.jsx($e,{color:{light:"red-600",dark:"red-300"},size:24}),e.jsxs(a,{color:{light:"red-700",dark:"red-300"},children:[e.jsx(s,{variant:"h5-semibold",color:{light:"red-700",dark:"red-300"},children:r.txError}),r.txErrorStatus===2&&e.jsxs(e.Fragment,{children:[e.jsx(s,{variant:"bs-regular",children:"1. Not enough Push tokens in your wallet."}),e.jsx(s,{variant:"bs-regular",children:"2. Gas price increased due to network congestion. Adjust gas limit manually."})]})]})]}),se=()=>e.jsxs(a,{display:"flex",flexDirection:"column",alignItems:"center",gap:"s1",alignSelf:"stretch",children:[e.jsx(s,{variant:"h3-semibold",color:{light:"gray-1000",dark:"gray-100"},display:{ml:"none",dp:"block"},children:"Create Your Channel"}),e.jsx(s,{variant:"bs-regular",color:{light:"gray-500",dark:"gray-600"},display:{ml:"none",dp:"block"},children:"Creating your own notification channel to manage, send and notify users."}),e.jsx(s,{variant:"h4-semibold",color:{light:"gray-1000",dark:"gray-100"},display:{ml:"block",dp:"none"},children:"Create Your Channel"}),e.jsx(s,{variant:"bes-regular",color:{light:"gray-500",dark:"gray-600"},display:{ml:"block",dp:"none"},textAlign:"center",children:"Creating your own notification channel to manage, send and notify users."})]}),ie=({progressState:r})=>e.jsxs(a,{display:"flex",flexDirection:"column",alignSelf:"stretch",gap:"s10",alignItems:"center",children:[e.jsx(a,{padding:"s6",backgroundColor:{light:"gray-100",dark:"gray-1000"},borderRadius:"r4",width:"-webkit-fill-available",children:e.jsx(s,{textAlign:"center",variant:"h5-semibold",color:"pink-600",children:r.progressInfo})}),e.jsx(a,{width:"400px",children:e.jsx(De,{percent:r.progress,color:"#D548EC",backgroundColor:"#F3AEFF",height:"4px"})}),e.jsxs(a,{display:"flex",flexDirection:"row",alignItems:"center",gap:"s1",children:[e.jsx(Pe,{type:Re.PROCESSING,size:16}),e.jsx(s,{variant:"bs-semibold",color:{light:"gray-800",dark:"gray-300"},children:r.processingInfo})]})]}),oe=()=>{const{switchChain:r}=q();return e.jsxs(e.Fragment,{children:[e.jsx(a,{display:"flex",flexDirection:"column",padding:"s6",backgroundColor:{light:"gray-100",dark:"gray-1000"},borderRadius:"r4",width:"-webkit-fill-available",children:e.jsx(s,{textAlign:"center",variant:"h5-semibold",color:"pink-600",children:"Please select Ethereum Sepolia Network in your Wallet to create a channel."})}),e.jsx(a,{display:"flex",justifyContent:"center",children:e.jsx(I,{onClick:()=>r(M.coreContractChain),children:"Change Network"})})]})},le=()=>ke({mutationKey:[Ee],mutationFn:K}),ce=()=>ke({mutationKey:[Ne],mutationFn:Y}),A=[0],O=Fe(E.toString(),18),T={progress:null,progressInfo:"",processingInfo:""},V={txErrorStatus:0,txError:""},de=()=>{const{account:r,provider:t,isWalletConnected:n,chainId:o,connect:l}=q(),h=M.coreContractChain===o,{mutate:b,isPending:f}=le(),{mutate:u,isPending:N}=ce(),[x,m]=g.useState(0),i=je({initialValues:{channelName:"",channelDesc:"",channelURL:""},validationSchema:Q,onSubmit:c=>{console.log("Values ",c),ge(),m(1)}}),[d,y]=g.useState(!1),[w,D]=g.useState(void 0),[_,v]=g.useState(T),[he,pe]=g.useState(V),ge=()=>{if(x<2){const c=x+1;A.push(c),m(c)}};g.useEffect(()=>{w&&re(w,D)},[w]);const j=(c,k,p)=>{v(S=>({...S,progress:c,progressInfo:k,processingInfo:p}))},F=(c,k)=>{pe(p=>({...p,txErrorStatus:c,txError:k}))},be=(c,k)=>{b({noOfTokenToApprove:O,signer:c},{onSuccess:p=>{p.status===1&&(j(60,"Please complete the transaction in your wallet to continue.","Approving PUSH"),ue(c,k))},onError:p=>(console.log("Error in approving PUSH Token",p),p.code===4001||p.code==="ACTION_REJECTED"?(console.log("Signature error ",p),F(1,"User Rejected Signature. Please try again.")):F(2,"Transaction failed due to one of the following reasons:"),v(T),!1)})},ue=(c,k)=>{let p=Ae.GENERAL;const S="1+"+k,P=Le(S);j(70,"Please complete the transaction in your wallet to continue.","Creating Channel..."),u({channelType:p,identityBytes:P,fees:O,signer:c},{onSuccess:C=>{C.status===0?F(2,"Transaction failed due to one of the following reasons:"):(console.log("Tx Successful",C),j(80,"Please wait while we confirm the transaction..","Transaction Confirmed.."),setTimeout(()=>{j(90,"Creating your channel, Aligning pixels, adjusting padding... This may take some time.","Redirecting... Please do not refresh")},2e3),setTimeout(()=>{j(100,"Creating your channel, Aligning pixels, adjusting padding... This may take some time.","Redirecting... Please do not refresh"),window.location.reload()},3e3))},onError:C=>{console.log("Error in transaction from query >>>>",C),C.code===4001||C.code==="ACTION_REJECTED"?(console.log("Signature error ",C),F(1,"User Rejected Signature. Please try again."),v(T)):(console.error("Error --> %o",C),console.error({error:C}),j(0,"There was an error in creating the Channel","Kindly Contact support@epns.io to resolve the issue."))}})},we=async()=>{if(v(T),pe(V),!n){l();return}if(!i.isValid){m(0);return}if(!w){m(1);return}j(10,"Checking for PUSH Token Approval","Loading...");const c=await ee({provider:t,account:r});console.log("Approved Token Amount >>",c);let k={name:i.values.channelName,info:i.values.channelDesc,url:i.values.channelURL,icon:w};const p=JSON.stringify(k);j(20,"Please wait, payload is getting uploaded to IPFS","Loading...");let S=await Ue(p);console.debug("IPFS storagePointer:",S),j(40,"Please complete the transaction in your wallet to continue.","Payload Uploaded...");var P=t.getSigner(r);console.debug(P),c<50?be(P,S):ue(P,S)};return e.jsxs(a,{padding:{initial:"s8",ml:"s4"},backgroundColor:{light:"white",dark:"gray-900"},borderRadius:"r8",display:"flex",width:{initial:"648px",ml:"325px"},flexDirection:"column",alignItems:"center",gap:"s10",children:[e.jsx(se,{}),!h&&e.jsx(oe,{}),he.txErrorStatus!==0&&e.jsx(te,{channelCreationError:he}),_.progress===null?e.jsxs(a,{display:"flex",flexDirection:"column",gap:"s8",alignItems:"center",alignSelf:"stretch",children:[e.jsx(G,{steps:X,completedSteps:A,setActiveStepIndex:m}),x==0&&e.jsx(ae,{channelInfoFormik:i}),x===1&&e.jsx(ne,{view:d,croppedImage:w,setView:y,setCroppedImage:D,setActiveStepIndex:m,handleNextStep:ge}),x===2&&e.jsx(Z,{channelStakeFees:E,handleCreateNewChannel:we})]}):e.jsx(ie,{progressState:_})]})},Ce=()=>e.jsx(Qe,{children:e.jsx(de,{})})});export{ar as __tla,Ce as default};

import{dn as ne,dp as ie,aZ as a,bk as l,bl as g,dq as se,dr as re,be as z,d4 as le,b8 as G,ba as O,cU as ce,bW as T,ds as oe,cX as de,dt as v,bo as y,du as _,dv as b,dw as ue,dx as he,bT as pe,dy as ge,dz as xe,bS as me,dA as ye,dB as fe,__tla as be}from"./index-BVCZN7ZR.js";import{c as Ce,a as u,u as ve,__tla as je}from"./index.esm-URbckxLf.js";import{C as ke,__tla as Se}from"./Cross-BwoTj3Pp.js";import{u as Te,__tla as _e}from"./useMutation-DgDHaiuI.js";import{g as Ie,__tla as Ue}from"./Common.utils-BwbFnxSG.js";import{g as h}from"./Common.form-LPxQflxb.js";import{C as we,__tla as Ae}from"./ContentLayout-L7jD38qp.js";let W,Le=Promise.all([(()=>{try{return be}catch{}})(),(()=>{try{return je}catch{}})(),(()=>{try{return Se}catch{}})(),(()=>{try{return _e}catch{}})(),(()=>{try{return Ue}catch{}})(),(()=>{try{return Ae}catch{}})()]).then(async()=>{let I,U,w,A,L,D,E,M,R,V,N,B,F,P;I=n=>n,U=({userPushSDKInstance:n,channel:t,recipients:s,payload:r,notification:c})=>n.channel.send(s,{notification:c,payload:r,channel:t}).then(I),w=()=>Te({mutationKey:[ne],mutationFn:U}),A=n=>{const t=ie(),s=({title:r,body:c,cta:x,channelName:C,icon:j,image:o,chainId:k})=>a.jsx(se,{notificationTitle:r,notificationBody:c,cta:x,app:C,icon:j,image:o,chainName:re[k],theme:t.mode,url:""});return a.jsxs(l,{display:"flex",flexDirection:"column",gap:"spacing-none",children:[a.jsx(g,{variant:"h6-semibold",color:"text-primary",textTransform:"uppercase",children:"Preview Notification"}),a.jsx(s,{...n})]})},L=n=>{var t,s;return[...((s=(t=n==null?void 0:n.aliases)==null?void 0:t.filter(r=>r.is_alias_verified))==null?void 0:s.map(r=>parseInt(r.alias_blockchain_id)))||[],z.coreContractChain]},D=n=>n&&n.length?n==null?void 0:n.map(t=>({icon:a.jsx(l,{width:"24px",height:"24px",borderRadius:"radius-xxs",overflow:"hidden",children:a.jsx("img",{width:"100%",height:"100%",src:t==null?void 0:t.iconV2,alt:t==null?void 0:t.name})}),label:t==null?void 0:t.name,value:t==null?void 0:t.channel})):[],E=n=>{var r;let t=[];const s={label:"Default",value:"0"};return n&&(t=((r=JSON.parse(n==null?void 0:n.channel_settings))==null?void 0:r.map((c,x)=>({label:c==null?void 0:c.description,value:(x+1).toString()})))||[]),[...t,s]},M=(n,t)=>{if(t){if(n==="SUBSET")return t.split(",");if(n==="TARGETTED")return[t]}return["*"]},R=(n,t,s)=>{var r;return console.debug(n),s?le(n.channel,parseInt(t)):((r=n.aliases.find(c=>c.alias_blockchain_id===t))==null?void 0:r.alias_address)||n.channel},V=[{label:"Broadcast",value:"BROADCAST"},{label:"Targeted",value:"TARGETTED"},{label:"Subset",value:"SUBSET"}],N=n=>Ce().shape({channelAddress:u().required(h("Delegate")),chainId:u().required(h("Chain")),type:u().required(h("Type")),body:u().required(h("Description")),setting:u().required(h("Setting")),recipient:u().test("recipient",h("Recipient"),function(t){return(this.parent.type!=="SUBSET"||n)&&(this.parent.type!=="TARGETTED"||!!t)}),title:u().test("title",h("Title"),function(t){return!this.parent.titleChecked||!!t}),mediaUrl:u().test("mediaUrl",h("Media URL"),function(t){return!this.parent.mediaUrlChecked||!!t}),ctaLink:u().test("ctaLink",h("CTA Link"),function(t){return!this.parent.ctaLinkChecked||!!t})}),B=n=>{var t;return{channelAddress:((t=n[0])==null?void 0:t.value)||"",chainId:z.coreContractChain.toString(),type:"BROADCAST",recipient:"",titleChecked:!1,mediaUrlChecked:!1,ctaLinkChecked:!1,title:"",body:"",setting:"0",mediaUrl:"",ctaLink:""}},F=({channelDetails:n})=>{const[t,s]=G.useState([]),{chainId:r}=O(),{mutate:c,isPending:x}=w(),C=ce(),{userPushSDKInstance:j}=T(i=>i.user),{delegatees:o}=T(i=>i.admin),k=ge===r,q=D(o!=null&&o.length?o:n?[n]:[]),e=ve({initialValues:B(q),validationSchema:N(!!t.length),onSubmit:i=>{Z(i)}}),d=(o==null?void 0:o.find(i=>i.channel===e.values.channelAddress))||n,J=Ie(L(d)),X=e.values.body||e.values.title||e.values.ctaLink||e.values.mediaUrl,Z=({chainId:i,title:p,type:m,recipient:f,ctaLink:$,mediaUrl:ee,body:K,setting:ae})=>{c({channel:R(d,i,k),recipients:M(m,f||t.join()),notification:{title:p,body:K},userPushSDKInstance:j,payload:{title:p,body:K,cta:$,embed:ee,category:parseInt(ae)??void 0}},{onSuccess:()=>{C.showMessageToast({toastTitle:"Success",toastMessage:"Successfully sent notification",toastType:"SUCCESS",getToastIcon:S=>a.jsx(oe,{size:S,color:"green"})}),e.resetForm()},onError:S=>{S&&C.showMessageToast({toastTitle:"Error",toastMessage:"Unable to send notification",toastType:"ERROR",getToastIcon:te=>a.jsx(de,{size:te,color:"red"})})}})},H=i=>{if(i.key==="Enter"&&i.preventDefault(),["Enter",","].includes(i.key)){const p=e.values.recipient.split(" ").filter(m=>m);s(m=>{const f=new Set([...m,...p]);return Array.from(f)}),e.setFieldValue("recipient","")}},Q=i=>{s(p=>p.filter((m,f)=>f!==i))},Y=i=>{e.setFieldValue("type",i),e.setFieldValue("recipient",""),s([])};return a.jsx("form",{onSubmit:e.handleSubmit,children:a.jsxs(l,{display:"flex",flexDirection:"column",gap:"spacing-xl",alignItems:"center",children:[a.jsxs(l,{display:"flex",gap:{dp:"spacing-md",ml:"spacing-sm"},width:"100%",flexDirection:"column",children:[a.jsxs(l,{display:"flex",gap:"spacing-sm",flexDirection:{dp:"row",ml:"column"},children:[a.jsx(l,{width:{dp:"65%",ml:"auto"},children:a.jsx(v,{options:q,value:e.values.channelAddress,onSelect:e.handleChange("channelAddress"),error:e.touched.channelAddress&&!!e.errors.channelAddress,errorMessage:e.touched.channelAddress?e.errors.channelAddress:""})}),a.jsx(v,{options:J,value:e.values.chainId,onSelect:e.handleChange("chainId"),error:e.touched.chainId&&!!e.errors.chainId,errorMessage:e.touched.chainId?e.errors.chainId:""})]}),a.jsx(v,{options:V,value:e.values.type,onSelect:i=>Y(i),error:e.touched.type&&!!e.errors.type,errorMessage:e.touched.type?e.errors.type:""}),a.jsxs(l,{display:"flex",gap:"spacing-sm",justifyContent:"space-between",css:y`
              flex-wrap: wrap;
            `,children:[a.jsxs(l,{css:y`
                flex: 1;
              `,display:"flex",alignItems:"center",backgroundColor:"surface-secondary",borderRadius:"radius-xs",justifyContent:"space-between",padding:"spacing-xs",children:[a.jsx(g,{ellipsis:!0,variant:"bs-semibold",children:"Title"}),a.jsx(_,{leadingToggle:!1,checked:e.values.titleChecked,onCheckedChange:i=>e.setFieldValue("titleChecked",i)})]}),a.jsxs(l,{css:y`
                flex: 1;
              `,display:"flex",backgroundColor:"surface-secondary",borderRadius:"radius-xs",alignItems:"center",justifyContent:"space-between",padding:"spacing-xs",children:[a.jsx(g,{ellipsis:!0,variant:"bs-semibold",children:"Media URL"}),a.jsx(_,{leadingToggle:!1,checked:e.values.mediaUrlChecked,onCheckedChange:i=>e.setFieldValue("mediaUrlChecked",i)})]}),a.jsxs(l,{css:y`
                flex: 1;
              `,display:"flex",backgroundColor:"surface-secondary",borderRadius:"radius-xs",alignItems:"center",justifyContent:"space-between",padding:"spacing-xs",children:[a.jsx(g,{ellipsis:!0,variant:"bs-semibold",children:"CTA Link"}),a.jsx(_,{leadingToggle:!1,checked:e.values.ctaLinkChecked,onCheckedChange:i=>e.setFieldValue("ctaLinkChecked",i)})]})]}),e.values.type==="TARGETTED"&&a.jsx(b,{placeholder:"Input Value",label:"Recipient Wallet Address",onChange:e.handleChange("recipient"),value:e.values.recipient,error:e.touched.recipient&&!!e.errors.recipient,errorMessage:e.touched.recipient?e.errors.recipient:""}),e.values.type==="SUBSET"&&a.jsxs(l,{display:"flex",flexDirection:"column",gap:"spacing-xs",onKeyDown:i=>H(i),children:[a.jsx(l,{display:"flex",gap:"spacing-xxs",css:y`
                  flex-wrap: wrap;
                `,children:!!t.length&&t.map((i,p)=>a.jsxs(l,{display:"flex",gap:"spacing-xxs",alignItems:"center",justifyContent:"space-between",padding:"spacing-xxxs spacing-xxs",borderRadius:"radius-xxxs",backgroundColor:"surface-brand-medium",children:[a.jsx(g,{color:"text-brand-subtle",children:i.slice(0,-1)}),a.jsx(l,{cursor:"pointer",display:"flex",alignItems:"center",onClick:()=>Q(p),children:a.jsx(ke,{size:14,color:"icon-secondary"})})]}))}),a.jsx(b,{placeholder:"Input Value",label:"Enter Recipients Wallet Addresses",description:"Enter recipients wallet addresses separated by a comma or by pressing the enter key",onChange:i=>e.setFieldValue("recipient",i.target.value),value:e.values.recipient,error:e.touched.recipient&&!!e.errors.recipient,errorMessage:e.touched.recipient?e.errors.recipient:""})]}),e.values.titleChecked&&a.jsx(b,{totalCount:80,placeholder:"Input Value",label:"Notification Title",onChange:e.handleChange("title"),value:e.values.title,error:e.touched.title&&!!e.errors.title,errorMessage:e.touched.title?e.errors.title:""}),a.jsx(ue,{label:"Notification Message",placeholder:"Input Value",totalCount:500,onChange:e.handleChange("body"),value:e.values.body,error:e.touched.body&&!!e.errors.body,errorMessage:e.touched.body?e.errors.body:""}),a.jsx(v,{action:a.jsx(he,{textProps:{color:"text-brand-medium"},to:"/channel/settings",children:"Manage Setting"}),label:"Notification Setting Type",options:E(d),value:e.values.setting,onSelect:e.handleChange("setting"),error:e.touched.setting&&!!e.errors.setting,errorMessage:e.touched.setting?e.errors.setting:""}),e.values.mediaUrlChecked&&a.jsx(b,{placeholder:"Input Value",label:"Media URL",onChange:e.handleChange("mediaUrl"),value:e.values.mediaUrl,totalCount:80,error:e.touched.mediaUrl&&!!e.errors.mediaUrl,errorMessage:e.touched.mediaUrl?e.errors.mediaUrl:""}),e.values.ctaLinkChecked&&a.jsx(b,{placeholder:"Input Value",label:"CTA Link",totalCount:80,onChange:e.handleChange("ctaLink"),value:e.values.ctaLink,error:e.touched.ctaLink&&!!e.errors.ctaLink,errorMessage:e.touched.ctaLink?e.errors.ctaLink:""}),X&&a.jsx(A,{title:e.values.title,body:e.values.body,cta:e.values.ctaLink,channelName:(d==null?void 0:d.name)||"",icon:(d==null?void 0:d.iconV2)||"",image:e.values.mediaUrl,chainId:parseInt(e.values.chainId)})]}),a.jsx(pe,{disabled:x,children:x?"Sending":" Send Notification"})]})})},P=()=>{const{userPushSDKInstance:n}=T(c=>c.user),{account:t}=O(),{data:s}=xe(t),r=me();return G.useEffect(()=>{s||r("/channels")},[s]),a.jsxs(l,{padding:{dp:"spacing-lg",ml:"spacing-sm"},display:"flex",flexDirection:"column",gap:{dp:"spacing-xl",ml:"spacing-md"},alignSelf:"center",width:{dp:"648px",ml:"357px"},borderRadius:"radius-lg",alignItems:"center",backgroundColor:"surface-primary",margin:{dp:"spacing-lg",ml:"spacing-sm"},children:[a.jsx(g,{color:"text-primary",variant:"h3-semibold",display:{dp:"block",ml:"none"},children:"Send Notification"}),a.jsx(g,{color:"text-primary",variant:"h5-semibold",display:{dp:"none",ml:"block"},children:"Send Notification"}),a.jsx(l,{width:"100%",children:a.jsx(F,{channelDetails:s})}),n&&(n==null?void 0:n.readmode())&&a.jsx(l,{display:"flex",justifyContent:"center",width:"-webkit-fill-available",alignItems:"center",css:y`
            z-index: 99999;
          `,children:a.jsx(ye,{type:fe.MODAL,showConnectModal:!0})})]})},W=()=>a.jsx(we,{children:a.jsx(P,{})})});export{Le as __tla,W as default};
